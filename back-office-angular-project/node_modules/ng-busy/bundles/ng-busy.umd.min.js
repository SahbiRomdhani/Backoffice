!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("@angular/animations"),require("@angular/common")):"function"==typeof define&&define.amd?define("ng-busy",["exports","@angular/core","rxjs","@angular/animations","@angular/common"],e):e(t["ng-busy"]={},t.ng.core,t.rxjs,t.ng.animations,t.ng.common)}(this,function(t,p,n,e,i){"use strict";var s=function(){function t(){}return t.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=p.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),o=function m(t){var e,i;void 0===t&&(t={});try{for(var n=function r(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}(Object.keys(u)),s=n.next();!s.done;s=n.next()){var o=s.value;this[o]=t[o]!==undefined?t[o]:u[o]}}catch(a){e={error:a}}finally{try{s&&!s.done&&(i=n["return"])&&i.call(n)}finally{if(e)throw e.error}}},r=function(){function t(t){this.instanceConfigHolder=t}return Object.defineProperty(t.prototype,"message",{get:function(){return this.instanceConfigHolder.config.message},enumerable:!0,configurable:!0}),t.decorators=[{type:p.Component,args:[{selector:"default-busy",template:'\n      <div class="ng-busy-default-wrapper">\n          <div class="ng-busy-default-sign">\n              <div class="ng-busy-default-spinner">\n                  <div class="bar1"></div>\n                  <div class="bar2"></div>\n                  <div class="bar3"></div>\n                  <div class="bar4"></div>\n                  <div class="bar5"></div>\n                  <div class="bar6"></div>\n                  <div class="bar7"></div>\n                  <div class="bar8"></div>\n                  <div class="bar9"></div>\n                  <div class="bar10"></div>\n                  <div class="bar11"></div>\n                  <div class="bar12"></div>\n              </div>\n              <div class="ng-busy-default-text">{{message}}</div>\n          </div>\n      </div>\n  '}]}],t.ctorParameters=function(){return[{type:s,decorators:[{type:p.Inject,args:["instanceConfigHolder"]}]}]},t}(),u={template:r,templateNgStyle:{},delay:0,minDuration:0,backdrop:!0,message:"Please wait...",wrapperClass:"ng-busy",disableAnimation:!1};function a(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var c=function(){function t(){this.isDelayProcessing=!1,this.isDurationProcessing=!1,this.isBusiesProcessing=!1,this.busyQueue=[],this.__isActive=!1,this.onStartBusy=new p.EventEmitter,this.onStopBusy=new p.EventEmitter}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.__isActive},set:function(t){!1===this.__isActive&&!0===t&&this.onStartBusy&&this.onStartBusy.emit(),!0===this.__isActive&&!1===t&&this.onStopBusy&&(this.isBusiesProcessing=!1,this.onStopBusy.emit()),this.__isActive=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"busyList",{get:function(){return this.busyQueue},enumerable:!0,configurable:!0}),t.prototype.load=function(t){this.loadBusyQueue(t.busyList),this.startLoading(t)},t.prototype.updateActiveStatus=function(){this.isActive=this.isBusiesProcessing&&!this.isDelayProcessing&&(this.isDurationProcessing||0<this.busyQueue.length)},t.prototype.startLoading=function(t){var e=this;!this.isBusiesProcessing&&0<this.busyList.length&&(this.isBusiesProcessing=!0,this.isDelayProcessing=!0,this.updateActiveStatus(),n.timer(t.delay).subscribe(function(){e.isDelayProcessing=!1,e.isDurationProcessing=!0,e.updateActiveStatus(),n.timer(t.minDuration).subscribe(function(){e.isDurationProcessing=!1,e.updateActiveStatus()})}))},t.prototype.loadBusyQueue=function(t){var i=this;t.filter(function(t){return t&&!t.hasOwnProperty("__loaded_mark_by_ng_busy")}).forEach(function(t){var e;Object.defineProperty(t,"__loaded_mark_by_ng_busy",{value:!0,configurable:!1,enumerable:!1,writable:!1}),e=a(t)?n.from(t).subscribe():t,i.appendToQueue(e)})},t.prototype.appendToQueue=function(t){var e=this;this.busyQueue.push(t),t.add(function(){e.busyQueue=e.busyQueue.filter(function(t){return!t.closed}),e.updateActiveStatus()})},t.prototype.ngOnDestroy=function(){},t.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=p.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),y=function(){function t(t){this.config=Object.assign({},u,t||new o)}return t.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o,decorators:[{type:p.Optional}]}]},t.ngInjectableDef=p.defineInjectable({factory:function(){return new t(p.inject(o,8))},token:t,providedIn:"root"}),t}(),d=e.style({opacity:0,transform:"translateY(-40px)"}),l=".3s ease",f=function(){function t(t,e,i){var n=this;this.instanceConfigHolder=t,this.busyEmitter=e,this.cdr=i,this.disableAnimation=!1,this.showBackdrop=!0,this.isActive=!1,this.busyMonitor=this.busyEmitter.subscribe(function(t){var e=n.instanceConfigHolder.config;n.isActive=t,n.wrapperClass=e.wrapperClass,n.showBackdrop=e.backdrop,n.disableAnimation=e.disableAnimation,n.cdr&&n.cdr.markForCheck()})}return t.prototype.ngOnDestroy=function(){this.busyMonitor&&this.busyMonitor.unsubscribe()},t.decorators=[{type:p.Component,args:[{selector:"lib-ng-busy",template:'<div [class]="wrapperClass" @flyInOut [@.disabled]="disableAnimation" *ngIf="isActive">\n  <ng-content></ng-content>\n</div>\n<div class="ng-busy-backdrop" @flyInOut [@.disabled]="disableAnimation" *ngIf="showBackdrop && isActive">\n</div>\n',styles:[""],animations:[e.trigger("flyInOut",[e.transition("void => *",[d,e.animate(l)]),e.transition("* => void",[e.animate(l,d)])])]}]}],t.ctorParameters=function(){return[{type:s,decorators:[{type:p.Inject,args:["instanceConfigHolder"]}]},{type:p.EventEmitter,decorators:[{type:p.Inject,args:["busyEmitter"]}]},{type:p.ChangeDetectorRef}]},t}(),h=function(){function t(t,e,i,n,s,o,r,a,u){var c=this;this.configHolder=t,this.instanceConfigHolder=e,this.resolver=i,this.tracker=n,this.appRef=s,this.vcr=o,this.element=r,this.renderer=a,this.injector=u,this.busyStart=new p.EventEmitter,this.busyStop=new p.EventEmitter,this.isLoading=!1,this.busyEmitter=new p.EventEmitter,this.onStartSubscription=n.onStartBusy.subscribe(function(){setTimeout(function(){c.recreateBusyIfNecessary(),c.isLoading=!0,c.busyEmitter.emit(c.isLoading),c.busyStart.emit()},0)}),this.onStopSubscription=n.onStopBusy.subscribe(function(){c.isLoading=!1,c.busyEmitter.emit(c.isLoading),c.busyStop.emit()})}return Object.defineProperty(t.prototype,"options",{get:function(){return this._option},set:function(t){this._option=t},enumerable:!0,configurable:!0}),t.prototype.ngDoCheck=function(){this.optionsNorm=this.normalizeOptions(this.options),this.instanceConfigHolder.config=this.optionsNorm,this.tracker.load({busyList:this.optionsNorm.busy,delay:this.optionsNorm.delay,minDuration:this.optionsNorm.minDuration})},t.prototype.ngOnDestroy=function(){this.destroyComponents(),this.onStartSubscription.unsubscribe(),this.onStopSubscription.unsubscribe()},t.prototype.recreateBusyIfNecessary=function(){this.busyRef&&this.template===this.optionsNorm.template&&this.templateNgStyle===this.optionsNorm.templateNgStyle||(this.destroyComponents(),this.template=this.optionsNorm.template,this.templateNgStyle=this.optionsNorm.templateNgStyle,this.createBusy(),this.busyEmitter.emit(this.isLoading))},t.prototype.normalizeOptions=function(t){return t?(Array.isArray(t)||a(t)||t instanceof n.Subscription)&&(t={busy:t}):t={busy:[]},t=Object.assign({},this.configHolder.config,t),Array.isArray(t.busy)||(t.busy=[t.busy]),t},t.prototype.destroyComponents=function(){this.busyRef&&this.busyRef.destroy(),this.componentViewRef&&this.appRef.detachView(this.componentViewRef)},t.prototype.createBusy=function(){var t=this.resolver.resolveComponentFactory(f),e=p.Injector.create({providers:[{provide:"instanceConfigHolder",useValue:this.instanceConfigHolder},{provide:"busyEmitter",useValue:this.busyEmitter}],parent:this.injector});this.template=this.optionsNorm.template,this.busyRef=this.vcr.createComponent(t,0,e,this.generateNgContent(e))},t.prototype.generateNgContent=function(t){if("string"==typeof this.template)return[[this.renderer.createText(this.template)]];if(this.template instanceof p.TemplateRef){return[this.template.createEmbeddedView({}).rootNodes]}var e=this.resolver.resolveComponentFactory(this.template).create(t);return e.instance.templateNgStyle=this.options.templateNgStyle,this.componentViewRef=e.hostView,this.appRef.attachView(this.componentViewRef),[[e.location.nativeElement]]},t.decorators=[{type:p.Directive,args:[{selector:"[ngBusy]",providers:[c,s]}]}],t.ctorParameters=function(){return[{type:y},{type:s},{type:p.ComponentFactoryResolver},{type:c},{type:p.ApplicationRef},{type:p.ViewContainerRef},{type:p.ElementRef},{type:p.Renderer2},{type:p.Injector}]},t.propDecorators={options:[{type:p.Input,args:["ngBusy"]}],busyStart:[{type:p.Output}],busyStop:[{type:p.Output}]},t}(),b=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:o,useValue:t}]}},e.decorators=[{type:p.NgModule,args:[{imports:[i.CommonModule],declarations:[r,h,f],providers:[y,c],exports:[h],entryComponents:[r,f]}]}],e}();t.NgBusyDirective=h,t.InstanceConfigHolderService=s,t.NgBusyModule=b,t.BusyConfig=o,t.DefaultBusyComponent=r,t.BUSY_CONFIG_DEFAULTS=u,t.ɵc=f,t.ɵb=y,t.ɵa=c,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ng-busy.umd.min.js.map